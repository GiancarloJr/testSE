<div class="tasks-container">
  <div class="header">
    <h1>{{ 'tasks.list.title' | t }}</h1>
    <button mat-raised-button color="primary" (click)="goToNew()">
      <mat-icon>add</mat-icon> {{ 'tasks.list.new' | t }}
    </button>
  </div>

  <div class="filters">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'tasks.filters.status' | t }}</mat-label>
      <mat-select [(value)]="filterStatus" (selectionChange)="onFilter()">
        <mat-option value="">{{ 'tasks.filters.all' | t }}</mat-option>
        @for (s of statusOptions; track s) {
          <mat-option [value]="s">{{ getStatusLabel(s) }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>{{ 'tasks.filters.finishDate' | t }}</mat-label>
      <input matInput [matDatepicker]="picker" [(ngModel)]="filterDate" (dateChange)="onFilter()" />
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <button mat-button (click)="clearFilters()">{{ 'tasks.filters.clear' | t }}</button>
  </div>

  @if (loading) {
    <div class="spinner-container">
      <mat-spinner diameter="48"></mat-spinner>
    </div>
  } @else if (dataSource.length === 0) {
    <div class="empty-state">
      <mat-icon class="empty-icon">assignment</mat-icon>
      <p>{{ 'tasks.empty.message' | t }}</p>
      <button mat-raised-button color="primary" (click)="goToNew()">{{ 'tasks.empty.cta' | t }}</button>
    </div>
  } @else {
    <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" class="full-width">
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>{{ 'tasks.table.title' | t }}</th>
          <td mat-cell *matCellDef="let task">{{ task.title }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>{{ 'tasks.table.status' | t }}</th>
          <td mat-cell *matCellDef="let task">
            <mat-chip-set>
              <mat-chip [highlighted]="true" [color]="getStatusColor(task.status)">
                {{ getStatusLabel(task.status) }}
              </mat-chip>
            </mat-chip-set>
          </td>
        </ng-container>

        <ng-container matColumnDef="finishDate">
          <th mat-header-cell *matHeaderCellDef>{{ 'tasks.table.finishDate' | t }}</th>
          <td mat-cell *matCellDef="let task">
            {{ task.finishDate ? (task.finishDate | date:'dd/MM/yyyy HH:mm') : ('common.notAvailable' | t) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef>{{ 'tasks.table.createdAt' | t }}</th>
          <td mat-cell *matCellDef="let task">{{ task.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>{{ 'tasks.table.actions' | t }}</th>
          <td mat-cell *matCellDef="let task">
            <button mat-icon-button [matTooltip]="'tasks.actions.edit' | t" (click)="goToEdit(task.id)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button [matTooltip]="'tasks.actions.delete' | t" color="warn" (click)="confirmDelete(task)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <mat-paginator
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  }
</div>
